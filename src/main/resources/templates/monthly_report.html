<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Laundry-Quoll</title>

    <!-- Bootstrap core CSS -->
    <link th:href="@{/Resources/dashgumfree_v2/Theme/assets/css/bootstrap.css}" rel="stylesheet">
    <!--external css-->
    <link th:href="@{/Resources/dashgumfree_v2/Theme/assets/font-awesome/css/font-awesome.css}" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" th:href="@{/Resources/dataTables/css/jquery.dataTables.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/Resources/dataTable-buttons/css/buttons.dataTables.css}">
    <link th:href="@{/Resources/bootstrap-datepicker-1.6.4-dist/css/bootstrap-datepicker.css}" rel="stylesheet" />        
            
    <!-- Custom styles for this template -->
    <link th:href="@{/Resources/dashgumfree_v2/Theme/assets/css/style.css}" rel="stylesheet">
    <link th:href="@{/Resources/dashgumfree_v2/Theme/assets/css/style-responsive.css}" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script th:src="@{https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js}"></script>
      <script th:src="@{https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js}"></script>
    <![endif]-->
  </head>

  <body>

  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" style="color:white" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a th:href="@{view_orders}" class="logo"><b>COMPLETE WORKWEAR</b></a>
            <!--logo end-->
            <div class="top-menu">
            	<ul class="nav pull-right top-menu">
                    <li><a class="logout" th:href="@{/logout}">Logout</a></li>
            	</ul>
            </div>
        </header>
      <!--header end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
              
              	  <p class="centered"><img th:src="@{/Resources/dashgumfree_v2/Theme/assets/img/ui-sam.jpg}" class="img-circle" width="60"></a></p>
              	  <h5 class="centered">Office person</h5>

                  <li class="sub-menu">
                      <a th:href="@{javascript:;}" >
                          <i class="fa fa-tasks"></i>
                          <span>Orders</span>
                      </a>
                      <ul class="sub">
                          <li><a  th:href="@{view_orders}">View orders</a></li>
                          <li><a  th:href="@{manage_recurring_orders}">Manage recurring orders</a></li>
                          <li><a  th:href="@{add_nonrecurring_orders}">Add non-recurring orders</a></li>
                      </ul>
                  </li>

                  <li class="sub-menu">
                      <a th:href="@{javascript:;}" >
                          <i class="fa fa-users"></i>
                          <span>Customers</span>
                      </a>
                      <ul class="sub">
                          <li><a  th:href="@{view_customers}">View customers</a></li>
                          <li><a  th:href="@{add_new_customer}">Add new customer</a></li>
                      </ul>
                  </li>  

                  <li class="sub-menu">
                      <a th:href="@{monthly_report}">
                          <i class="fa fa-bar-chart-o"></i>
                          <span>Monthly report</span>
                      </a>
                  </li>                

              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper site-min-height">
          	<h3><i class="fa fa-angle-right"></i> Monthly report</h3>
			<div class="row mt">
				<div class="col-lg-2">
					<div class="input-group date" data-provide="datepicker">
					    <input type="text" class="form-control" placeholder="Start date" id="startdate">
					    <div class="input-group-addon">
					        <span class="glyphicon glyphicon-calendar"></span>
					    </div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="input-group date" data-provide="datepicker">
					    <input type="text" class="form-control" placeholder="End date" id="enddate">
					    <div class="input-group-addon">
					        <span class="glyphicon glyphicon-calendar"></span>
					    </div>
					</div>
				</div>
				<div class="col-lg-2">
                    <select class="form-control" id="companyid" name="companyID" title="Choose one of the following...">
                    </select>
				</div>
				<div class="col-lg-4">
					<button type="button" class="btn btn-theme" onclick="searchReport();">Search</button>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<button type="button" class="btn btn-theme" onclick="exportReport();">Export excel</button>
				</div>
			</div><!-- /row -->
			
              <div class="row mt" id="reportdiv" style="display: none;">
                  <div class="col-md-12">
                      <div class="content-panel" id="tablediv">
                   		  <h4><i class="fa fa-angle-right"></i> <span id="table-title">Basic Table</span></h4>
                  	  	  <hr>
                          <table id="monthly-report-table" class="table table-striped table-advance table-hover">
                              <thead>
                              <tr>
                                  <th><i class="fa fa-tags"></i> Short name</th>
                                  <th><i class="fa fa-tags"></i> Full name</th>
                                  <th><i class="fa fa-usd"></i> Quantity</th>
                              </tr>
                              </thead>
                          </table>
                      </div><!-- /content-panel -->
                  </div><!-- /col-md-12 -->
              </div><!-- /row -->
              
		</section><! --/wrapper -->
      </section><!-- /MAIN CONTENT -->

      <!--main content end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery.js}"></script>
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/bootstrap.min.js}"></script>
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery-ui-1.9.2.custom.min.js}"></script>
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery.ui.touch-punch.min.js}"></script>
    <script class="include" type="text/javascript" th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery.dcjqaccordion.2.7.js}"></script>
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery.scrollTo.min.js}"></script>
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery.nicescroll.js}" type="text/javascript"></script>


    <!--common script for all pages-->
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/common-scripts.js}"></script>

	<!--script for this page-->
    <script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery-ui-1.9.2.custom.min.js}"></script>

	<!--custom switch-->
	<script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/bootstrap-switch.js}"></script>
	
	<!--custom tagsinput-->
	<script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/jquery.tagsinput.js}"></script>
	
	<!--custom checkbox & radio-->
	
	<script type="text/javascript" th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/bootstrap-inputmask/bootstrap-inputmask.min.js}"></script>
	
	
	<script th:src="@{/Resources/dashgumfree_v2/Theme/assets/js/form-component.js}"></script> 
	
	<!--custom dataTables-->
	<script type="text/javascript" charset="utf8" th:src="@{/Resources/dataTables/js/jquery.dataTables.js}"></script>
    <script type="text/javascript" charset="utf8" th:src="@{/Resources/dataTable-buttons/js/dataTables.buttons.js}"></script>
    
    <!--custom dataPicker-->
    <script th:src="@{/Resources/bootstrap-datepicker-1.6.4-dist/js/bootstrap-datepicker.js}"></script>
    
    <script th:src="@{/js/layer.js}"></script>
  <script>
  
  $(document).ready( function () {
	// get the list of all companies in the system
  	$.ajax({
          type: "GET",
          url: 'company/getAll',
          cache : false,
          dataType: "json",
          success: function(result) {
          	for(var i=0;i<result.data.length;i++){
          		if (result.data[i].active == 1) {
                  var company = "<option value='" + result.data[i].id + "'>" + result.data[i].name + "</option>";
                  $('#companyid').append(company);
          		}
              }
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
              alert("Failed.");
          }
      });
  });
  
  // show the table of monthly report of a chosen company in the page 
  function searchReport() {
	  var startdate = $('#startdate').val();
	  var enddate = $('#enddate').val();
	  var companyid = $('#companyid').val();
	  if (startdate=="") {
		  return layer.msg('Start date can not be empty.', function(){});
	  }
	  if (enddate=="") {
		  return layer.msg('End date can not be empty.', function(){});
	  }
	  if (companyid=="") {
		  return layer.msg('Company can not be empty.', function(){});
	  }
	  if (isDateSmaller(enddate,startdate)) {
		  return layer.msg('End date can not be ealiear than start date.', function(){});
	  }
	  var param = "startdate="+startdate+"&enddate="+enddate+"&companyID="+companyid;
	  
	  var table = $("#monthly-report-table");  
      var tbody = table.children();  
      var trs = tbody.children(); 
      for (var i=1; i<trs.length; i++) {
    	  trs[i].remove();
      }
	  
	  $.ajax({
          type: "GET",
          url: 'order/report',
          cache : false,
          data : param,
          dataType: "json",
          success: function(result) {
       	    document.getElementById("reportdiv").style.display="";
        	$('#table-title').html($("#companyid").find("option:selected").text());
        	var table = $("#monthly-report-table"); 
          	for(var i=0;i<result.length;i++){
          		var tr= $("<tr>" +  
                        "<td>"+result[i].shortname+"</td>" +
                        "<td>"+result[i].fullname+"</td>" +
                        "<td>"+result[i].countNumber+"</td>");
          		table.append(tr);
            }
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
        	  return layer.msg('No result.', {time:800});
          }
      });
  }
  
  // export the report as an excel and download it
  function exportReport(){
	  var startdate = $('#startdate').val();
	  var enddate = $('#enddate').val();
	  if (startdate=="") {
		  return layer.msg('Start date can not be empty.', function(){});
	  }
	  if (enddate=="") {
		  return layer.msg('End date can not be empty.', function(){});
	  }
	  if (isDateSmaller(enddate,startdate)) {
		  return layer.msg('End date can not be ealiear than start date.', function(){});
	  }
	  var param = "startdate="+startdate+"&enddate="+enddate;
	  var url = "order/excel?"+param;
	  
	  window.location.href=url;
  }
  
  // compare whether date1 is ealiear than date2
  function isDateSmaller(date1, date2) {
	  var tempdate1 = date1.split('/')[2]+date1.split('/')[0]+date1.split('/')[1];
      var tempdate2 = date2.split('/')[2]+date2.split('/')[0]+date2.split('/')[1];
      if (tempdate1>tempdate2) {
      	return false;
      } else {
   	  	return true;
      }
  }

  </script>

  </body>
</html>
